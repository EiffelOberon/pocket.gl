<!DOCTYPE html>
<html lang="en">
	<head>
		<title>webgl shader widget</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style type="text/css" media="screen">
			html, body { margin: 10px; }
		</style>

		<script src="pocket.gl.js"></script>
	</head>
	<body>
		<table>
			<tr>
				<td><div id="container1" style="position: relative;"></div></td>
				<td><div id="container2" style="position: relative;"></div></td>
			</tr>
		</table>

		<script>

			var params = {
				meshes: [
					{ url: "meshes/teapot.DAE", name: "Teapot", y: -23},
					{ url: "meshes/torus.DAE",  name: "Torus",  y: 0}
				],

				textures: [
					{ 
						url: "textures/noise.png", 
						wrap: "repeat", // repeat (default), clamp
						uniformName: "noiseTexture"
					}
				],

				uniforms: {
					seed: 	   { type: "f", value: 62 , min: 0, max: 100, displayName: "Seed" },
					intensity: { type: "f", value: 0.5, min: 0, max: 1  , displayName: "Intensity" },
				},

				editorTheme: "twilight",
				doubleSided: true,

				vertexShader: [
					"varying vec3 normalInterp;",
					"varying vec3 vertPos;",
					"varying vec2 texcoord;",
					"",
					"attribute vec2 uv2;",
					"",
					"uniform float intensity;",
					"uniform float seed;",
					"uniform sampler2D noiseTexture;",
					"",
					"void main(){",
					"    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);",
					"    vec4 vertPos4 = modelViewMatrix * vec4(position, 1.0);",
					"",
					"    vertPos = vec3(vertPos4) / vertPos4.w;",
					"    vec4 noise = texture2D(noiseTexture, uv2 + vec2(seed/100.0, seed/30.0));",
					"    vec3 normalOffset = vec3(noise.r-0.5, noise.g-0.5, 0) * intensity * 0.4;",
					"    vec3 distortedNormal = normalize(normal + normalOffset);",
					"",
					"    normalInterp = normalMatrix * distortedNormal;",
					"",
					"    texcoord = uv;",
					"}"
				].join("\n"),

				fragmentShader: [
			        "precision mediump float;",
			        "",
					"varying vec3 normalInterp;",
					"varying vec3 vertPos;",
					"",
					"const vec3 lightPos 	= vec3(200,60,100);",
					"const vec3 ambientColor = vec3(0.2, 0.0, 0.0);",
					"const vec3 diffuseColor = vec3(0.5, 0.0, 0.0);",
					"const vec3 specColor 	= vec3(1.0, 1.0, 1.0);",
					"",
					"void main() {",
					"	vec3 normal = normalize(normalInterp);",
					"	vec3 lightDir = normalize(lightPos - vertPos);",
					"",
					"	float lambertian = max(dot(lightDir,normal), 0.0);",
					"	float specular = 0.0;",
					"",
					"	if(lambertian > 0.0) {",
					"		vec3 viewDir = normalize(-vertPos);",
					"		vec3 halfDir = normalize(lightDir + viewDir);",
					"		float specAngle = max(dot(halfDir, normal), 0.0);",
					"		specular = pow(specAngle, 16.0);",
					"	}",
					"",
					"	gl_FragColor = vec4(ambientColor + lambertian * diffuseColor + specular * specColor, 1.0);",
					"}"
				].join("\n")
			}
			
			new PocketGL("container1", params, "../examples/flat-shader"); 
		</script>
	</body>
</html>

